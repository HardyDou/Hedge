# WebDAV 同步快速开始指南

## 5 分钟配置 WebDAV 同步

### 方案 1: 坚果云（推荐新手）

**优点**: 配置简单，国内访问快，1GB 免费空间

#### 步骤：

1. **注册坚果云账号**
   - 访问: https://www.jianguoyun.com/
   - 注册免费账号

2. **生成应用密码**
   - 登录网页版
   - 点击右上角头像 → 账户信息
   - 安全选项 → 第三方应用管理
   - 添加应用，输入名称（如 "Hedge"）
   - 复制生成的应用密码

3. **在 Hedge 中配置**
   - 打开 Hedge → 设置 → 同步设置
   - 选择 "WebDAV 同步"
   - 点击 "坚果云" 模板
   - 填写：
     - 服务器地址: `https://dav.jianguoyun.com/dav/` （已自动填写）
     - 用户名: 你的邮箱
     - 密码: 刚才复制的应用密码
     - 远程路径: `Hedge/vault.db` （已自动填写）
   - 点击 "测试连接"
   - 测试成功后，点击 "保存并启用"

4. **完成！**
   - 创建一个密码条目测试
   - 在坚果云网页版查看是否有 `Hedge/vault.db` 文件

---

### 方案 2: Nextcloud（推荐技术用户）

**优点**: 完全掌控数据，无限空间，开源

#### 前提条件：
- 有自己的服务器或 VPS
- 已安装 Nextcloud

#### 步骤：

1. **获取 WebDAV 地址**
   - 登录 Nextcloud
   - 点击左下角设置图标
   - 复制 WebDAV 地址，格式类似：
     ```
     https://your-nextcloud.com/remote.php/dav/files/username/
     ```

2. **在 Hedge 中配置**
   - 打开 Hedge → 设置 → 同步设置
   - 选择 "WebDAV 同步"
   - 点击 "Nextcloud" 模板
   - 填写：
     - 服务器地址: 刚才复制的 WebDAV 地址
     - 用户名: Nextcloud 用户名
     - 密码: Nextcloud 密码
     - 远程路径: `Hedge/vault.db`
   - 点击 "测试连接"
   - 测试成功后，点击 "保存并启用"

3. **完成！**
   - 在 Nextcloud 文件管理中查看 `Hedge/vault.db`

---

### 方案 3: Synology NAS（推荐 NAS 用户）

**优点**: 本地存储，速度快，完全私有

#### 前提条件：
- 有 Synology NAS
- NAS 可以通过网络访问

#### 步骤：

1. **启用 WebDAV**
   - 登录 DSM
   - 控制面板 → 文件服务 → WebDAV
   - 勾选 "启用 WebDAV"
   - 勾选 "启用 HTTPS 连接"
   - 记下端口号（默认 5006）

2. **在 Hedge 中配置**
   - 打开 Hedge → 设置 → 同步设置
   - 选择 "WebDAV 同步"
   - 点击 "Synology NAS" 模板
   - 填写：
     - 服务器地址: `https://your-nas-ip:5006/`
     - 用户名: NAS 用户名
     - 密码: NAS 密码
     - 远程路径: `Hedge/vault.db`
   - 点击 "测试连接"
   - 测试成功后，点击 "保存并启用"

3. **完成！**
   - 在 File Station 中查看 `Hedge/vault.db`

---

## 多设备同步

### 在第二台设备上配置

1. 安装 Hedge
2. 进入设置 → 同步设置
3. 选择 "WebDAV 同步"
4. 输入**相同的**服务器配置
5. 保存并启用
6. 应用会自动下载 vault.db
7. 输入主密码解锁

### 注意事项

- ✅ 所有设备使用相同的 WebDAV 配置
- ✅ 所有设备使用相同的主密码
- ✅ 修改会自动同步（30秒内）
- ⚠️ 避免同时在多台设备上修改同一条目

---

## 常见问题

### Q: 连接测试失败怎么办？

**A: 检查以下几点：**

1. **服务器地址是否正确**
   - 必须以 `http://` 或 `https://` 开头
   - 坚果云: `https://dav.jianguoyun.com/dav/`
   - Nextcloud: `https://your-domain/remote.php/dav/files/username/`

2. **用户名密码是否正确**
   - 坚果云必须使用应用密码，不是登录密码
   - 检查是否有多余的空格

3. **网络是否正常**
   - 尝试在浏览器中访问服务器地址
   - 检查防火墙设置

4. **服务器是否支持 WebDAV**
   - 确认 WebDAV 服务已启用

### Q: 如何知道同步是否成功？

**A: 检查方法：**

1. 在 Hedge 中创建一个测试条目
2. 等待 30 秒
3. 登录 WebDAV 服务器（网页版）
4. 查看是否有 `Hedge/vault.db` 文件
5. 检查文件修改时间是否是刚才

### Q: 多台设备同时修改会怎样？

**A: 冲突处理：**

- 应用会检测到冲突
- 自动创建备份文件（`vault_conflict_timestamp.db`）
- 保留最新的版本
- 你可以手动恢复备份文件

### Q: 可以切换同步方式吗？

**A: 可以，但要注意：**

1. 切换前先备份数据
2. 从 WebDAV 切换到本地：数据会保留在本地
3. 从本地切换到 WebDAV：会上传本地数据到服务器
4. 同一时间只能使用一种同步方式

### Q: WebDAV 安全吗？

**A: 非常安全：**

1. ✅ 使用 HTTPS 加密传输
2. ✅ vault.db 本身已加密
3. ✅ 即使服务器被攻破，数据仍然安全
4. ✅ 需要主密码才能解密
5. ✅ 密码使用系统 Keychain 加密存储

### Q: 流量消耗大吗？

**A: 非常小：**

- vault.db 通常 < 1MB
- 只在有变化时才上传/下载
- 每月流量消耗 < 10MB（正常使用）

### Q: 可以用其他 WebDAV 服务吗？

**A: 可以，支持任何标准 WebDAV 服务：**

- ✅ 坚果云
- ✅ Nextcloud
- ✅ ownCloud
- ✅ Synology NAS
- ✅ QNAP NAS
- ✅ Box.com
- ✅ 自建 WebDAV 服务器

---

## 故障排除

### 问题 1: "连接失败: Connection refused"

**原因**: 无法连接到服务器

**解决方案**:
1. 检查服务器地址是否正确
2. 检查网络连接
3. 检查防火墙设置
4. 确认服务器正在运行

### 问题 2: "连接失败: 401 Unauthorized"

**原因**: 用户名或密码错误

**解决方案**:
1. 检查用户名是否正确
2. 坚果云确认使用的是应用密码
3. 检查密码是否有多余空格
4. 尝试重新生成密码

### 问题 3: "连接失败: 404 Not Found"

**原因**: 服务器地址或路径错误

**解决方案**:
1. 检查服务器地址末尾是否有 `/`
2. Nextcloud 确认路径包含用户名
3. 尝试在浏览器中访问该地址

### 问题 4: 同步延迟

**原因**: 使用轮询机制，有 30 秒延迟

**解决方案**:
- 这是正常的，等待 30 秒即可
- 未来版本会支持实时同步

### 问题 5: 冲突文件

**原因**: 多台设备同时修改

**解决方案**:
1. 查看备份文件（`vault_conflict_*.db`）
2. 对比两个文件
3. 选择保留哪个版本
4. 删除不需要的文件

---

## 最佳实践

### 1. 定期备份

即使使用 WebDAV 同步，也建议定期导出备份：
- 设置 → 导出数据
- 保存到安全的地方

### 2. 使用强密码

- WebDAV 密码使用强密码
- 坚果云使用应用密码，不是登录密码
- 定期更换密码

### 3. 避免冲突

- 尽量不要同时在多台设备上修改
- 修改后等待同步完成再切换设备

### 4. 监控同步状态

- 注意同步错误提示
- 定期检查 WebDAV 服务器上的文件

### 5. 测试恢复

- 定期测试从 WebDAV 恢复数据
- 确保备份可用

---

## 下一步

配置完成后，你可以：

1. ✅ 在多台设备上安装 Hedge
2. ✅ 使用相同的 WebDAV 配置
3. ✅ 享受自动同步
4. ✅ 数据完全掌控在自己手中

有问题？查看完整文档：`docs/sync-implementation-complete.md`
