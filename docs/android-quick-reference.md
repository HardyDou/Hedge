# Android 同步方案 - 快速参考

**版本**: 1.0
**日期**: 2026-03-01

---

## 🎯 一句话总结

**Android 用 WebDAV（推荐）或局域网同步，不用厂商云（小米云/华为云）。**

---

## ✅ 推荐方案

### 方案 1: WebDAV（强烈推荐）⭐⭐⭐⭐⭐

**适用**: 所有 Android 用户

**优点**:
- ✅ 完全掌控数据（用户自己的服务器）
- ✅ 跨平台（可与 iOS 用户同步）
- ✅ 无隐私风险
- ✅ 国内可用（坚果云/Nextcloud/NAS）

**工作量**: 2-3 周

**支持的服务**:
- Nextcloud（自建，推荐）
- Synology NAS（自建，推荐）
- 坚果云（云服务，1GB 免费）
- ownCloud（自建）
- Box.com（云服务，10GB 免费）

**用户配置**:
```
服务器地址: https://your-server.com/webdav
用户名: your-username
密码: your-password
```

**代码示例**:
```dart
// 上传
final client = newClient('https://server.com/webdav',
                         user: 'user', password: 'pass');
await client.write('Hedge/vault.db', fileBytes);

// 下载
final data = await client.read('Hedge/vault.db');
```

---

### 方案 2: 局域网同步（可选）⭐⭐⭐⭐

**适用**: 家庭/办公室用户

**优点**:
- ✅ 速度快（局域网速度）
- ✅ 无需互联网
- ✅ 自动发现设备

**缺点**:
- ⚠️ 需要同一 Wi-Fi 网络
- ⚠️ 无法远程同步

**工作量**: 1-2 周

**用户体验**:
1. 打开应用，自动扫描局域网设备
2. 显示可用设备列表
3. 点击"同步"

---

### 方案 3: Dropbox（备选）⭐⭐⭐

**适用**: 普通用户

**优点**:
- ✅ 用户体验好（自动同步）
- ✅ 无需配置服务器
- ✅ 国内可用

**缺点**:
- ❌ 隐私风险（数据存储在 Dropbox）
- ❌ 违背"Local-First"理念

**工作量**: 2-3 周

**决策**: 根据用户反馈决定是否实施

---

## ❌ 不推荐方案

### 厂商云服务

| 厂商 | 为什么不推荐 |
|------|------------|
| **小米云** | 无法跨品牌、API 限制多 |
| **华为云** | 无法跨品牌、需要 HMS SDK |
| **OPPO 云** | 无公开 API |
| **vivo 云** | 无公开 API |
| **三星云** | 无法跨品牌、API 限制多 |

**核心问题**:
1. ❌ 无法跨品牌同步（小米手机无法同步到华为手机）
2. ❌ API 限制多，功能有限
3. ❌ 需要集成多个 SDK，维护成本极高
4. ❌ 隐私风险

---

## 📊 方案对比

| 方案 | 评分 | 跨平台 | 隐私保护 | 实施难度 | 推荐度 |
|------|------|-------|---------|---------|-------|
| **WebDAV** | 9/10 | ✅ 是 | ⭐⭐⭐⭐⭐ | 🟢 简单 | ⭐⭐⭐⭐⭐ |
| **局域网** | 8/10 | ✅ 是 | ⭐⭐⭐⭐⭐ | 🟢 简单 | ⭐⭐⭐⭐ |
| **Dropbox** | 7/10 | ✅ 是 | ⭐⭐⭐ | 🟡 中等 | ⭐⭐⭐ |
| **厂商云** | 3/10 | ❌ 否 | ⭐⭐ | 🔴 困难 | ⭐ |

---

## 🚀 实施计划

### P1: WebDAV（必须实施）

**时间**: Week 1-2

**任务**:
1. 集成 `webdav_client` 包
2. 创建配置页面
3. 实现上传/下载逻辑
4. 添加配置模板（Nextcloud/坚果云/NAS）

---

### P2: 局域网同步（建议实施）

**时间**: Week 3-4

**任务**:
1. 实现 HTTP 服务器
2. 实现 mDNS 设备发现
3. 创建同步 UI

---

### P3: Dropbox（可选）

**时间**: Week 5-6

**任务**:
1. 实现 OAuth 授权
2. 集成 Dropbox API
3. 添加自动同步

---

## 💡 用户配置示例

### 坚果云（最简单）

```
服务器地址: https://dav.jianguoyun.com/dav/
用户名: your-email@example.com
密码: 应用密码（在坚果云网页端生成）
```

**步骤**:
1. 注册坚果云账号
2. 进入"账户信息 > 安全选项 > 第三方应用管理"
3. 添加应用，生成应用密码
4. 在 Hedge 中配置

---

### Nextcloud

```
服务器地址: https://your-nextcloud.com/remote.php/dav/files/username/
用户名: nextcloud-username
密码: nextcloud-password
```

---

### Synology NAS

```
服务器地址: https://your-nas-ip:5006/
用户名: nas-username
密码: nas-password
```

---

## 📋 用户界面设计

### 首次启动

```
┌─────────────────────────────────────┐
│  选择数据存储方式                    │
│                                     │
│  ○ 仅本地存储（默认）                │
│    数据仅保存在本设备                │
│                                     │
│  ○ WebDAV 同步（推荐）               │
│    使用您的私有云服务器              │
│                                     │
│  ○ 局域网同步                        │
│    与同一 Wi-Fi 的设备同步           │
│                                     │
│  [ 继续 ]                           │
└─────────────────────────────────────┘
```

### 设置页面

```
┌─────────────────────────────────────┐
│  同步设置                            │
├─────────────────────────────────────┤
│  WebDAV 同步              [关闭]    │
│  配置 WebDAV 服务器 >                │
│                                     │
│  局域网同步                [关闭]    │
│  扫描局域网设备 >                    │
│                                     │
│  [ 手动同步 ]                        │
│  [ 查看同步日志 ]                    │
└─────────────────────────────────────┘
```

---

## 💰 成本

**开发成本**: 1-1.5 人月

**运营成本**: $0（用户自付）

---

## ✅ 核心建议

1. **优先实施 WebDAV**
   - 完全符合"Local-First"理念
   - 跨平台支持
   - 技术用户友好

2. **不要集成厂商云**
   - 无法跨品牌
   - 维护成本极高
   - 隐私风险

3. **提供详细教程**
   - 坚果云配置教程
   - Nextcloud 配置教程
   - NAS 配置教程

4. **默认本地存储**
   - 最简单
   - 用户可随时启用同步

---

## 📞 快速导航

- 详细分析: `android-sync-solution.md`
- WebDAV 实施: `implementation-guide-webdav.md`
- 完整报告: `COMPLETE_ANALYSIS_REPORT.md`

---

**Android 方案总结** ✅

**推荐**: WebDAV（P1）+ 局域网同步（P2）

**不推荐**: 厂商云服务（小米云/华为云等）
