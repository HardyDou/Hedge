# 密码本 产品需求文档 (PRD)

**状态:** 桌面端开发中 (Desktop Development In Progress)
**最后更新:** 2026-02-27
**应用名称:** 密码本 (NotePassword)

---

## 1. 背景与问题 (Context & Problem)

### 1.1 为什么做这个？ (Why)
目前的密码管理市场两极分化：
*   **商业软件 (1Password, LastPass):** 功能强大但订阅昂贵，且数据存储在厂商服务器，存在潜在的数据泄露风险（如 LastPass 泄露事件）。
*   **开源软件 (KeePass, Bitwarden):** KeePass 体验较古老，同步配置复杂；Bitwarden 自托管方案对用户有一定技术门槛。

**密码本**的核心价值在于**"极简且安全"**：
*   **数据绝对掌控:** 没有任何厂商服务器，数据文件由用户自己保管（iCloud/厂商云）。
*   **零成本维护:** 无需购买服务器，无需订阅费。
*   **原生体验:** 采用 iOS 设计规范，提供现代化 UI/UX。
*   **跨平台支持:** 同时支持移动端（iOS/Android）和桌面端（macOS/Linux/Windows）。

### 1.2 为什么现在做？ (Why Now)
*   **用户隐私意识觉醒:** 越来越多用户倾向于"本地优先 (Local-First)"的软件架构。
*   **云服务普及:** iCloud Drive 和各类手机厂商云服务已高度成熟，为"无服务器同步"提供了完美的基础设施。
*   **跨平台需求:** 用户拥有多台设备（Mac + Android 手机）的场景日益普遍，需要一个轻量级的跨生态解决方案。
*   **桌面端需求:** 用户希望在桌面端也能快速访问密码，需要类似 1Password 的桌面端体验。

---

## 2. 成功指标 (Success Metrics)

*   **核心体验:**
    *   **同步成功率:** 跨设备（iOS ↔ Android ↔ Desktop）修改密码后，另一端同步延迟 < 30秒（依赖云服务推送）。
    *   **解锁速度:** 冷启动至进入主界面 < 1秒（移动端）/ < 2秒（桌面端）。
    *   **桌面端响应速度:** 菜单栏图标点击响应 < 200ms，密码复制至剪贴板 < 100ms。
*   **用户价值:**
    *   **零数据丢失:** 极端情况下（如同步冲突），必须保留冲突副本，绝不覆盖用户数据。
    *   **迁移顺滑:** 从主流竞品（Chrome/1Password）导入成功率 > 95%。

---

## 3. 用户故事 (User Stories)

### 3.1 核心场景
*   **作为** 一名拥有 iPhone 和 MacBook 的用户，**我想要** 在 Mac 上保存的密码自动出现在 iPhone 上，**以便于** 我无需手动传输即可登录 APP。
*   **作为** 一名 Android 用户，**我想要** 使用指纹快速解锁查看密码，**以便于** 在超市结账时快速找到会员卡号。
*   **作为** 一名桌面端用户，**我想要** 通过菜单栏图标快速搜索并复制密码，**以便于** 无需打开主窗口即可快速使用。
*   **作为** 一名注重隐私的用户，**我想要** 确信我的密码库文件只存在于我信任的云盘中，**而不被** 任何第三方应用开发商获取。
*   **作为** 一名新用户，**我想要** 一键导入我在 Chrome 浏览器保存的所有密码，**以便于** 我能立即开始使用而无需手动输入。
*   **作为** 一名多设备用户，**当** 我在两台设备同时修改了同一个账号密码时，**我希望** 系统能保留两个版本并提示我，**而不是** 悄悄覆盖掉其中一个。

---

## 4. 功能需求 (Functional Requirements)

### 4.1 核心数据结构 (Vault Item)
每个条目（Item）应包含以下字段：
*   **标题 (Title):** 必填，用于列表展示。
*   **账号/用户名 (Username):** 选填。
*   **密码 (Password):** 
    *   **文本密码:** 支持隐藏/显示，支持随机密码生成器，支持详情页全屏放大显示。
*   **网址 (URL):** 选填，支持点击跳转。
*   **备注 (Notes):** 支持多行文本，用于记录安全问题、恢复码等。
*   **分类/标签 (Category/Tags):** 用于筛选和组织。
*   **附件 (Attachments):** 支持存储多个文件附件。
*   **修改时间 (Updated At):** 用于同步冲突解决。

### 4.2 账户与安全 (Security)
*   **主密码 (Master Password):** 用户首次启动需设置主密码。主密码用于加密本地数据库（Vault）。
*   **生物识别解锁:** 
    *   iOS/macOS: 支持 FaceID / TouchID。
    *   Android: 支持指纹识别 / 面部识别 (BiometricPrompt API)。
    *   支持在设置中开启/关闭生物识别，并在解锁失败时显示具体错误信息。
*   **零知识架构:** 应用不上传任何明文数据。所有数据在写入存储前必须经过 AES-256 (或更高标准如 XChaCha20-Poly1305) 加密。
*   **自动锁屏:** 
    *   应用切后台或闲置一定时间后自动锁定。
    *   支持在设置中通过 Action Sheet 配置自动锁屏延迟时间 (不限时，1秒，5秒，10秒，30秒，60秒)。
    *   **实现说明:** 使用 `WidgetsBindingObserver` 监听应用生命周期，在 `AppLifecycleState.paused` 时立即检查超时并锁定，确保锁屏生效。

*   **忘记密码处理:**
    *   **生物识别重置:** 如果设备已开启生物识别（FaceID/TouchID/指纹），可通过生物识别验证身份后重置主密码。
    *   **重建密码库:** 如果没有生物识别，只能清除旧数据并创建新密码库（旧密码库会自动备份为 `vault_backup.db`）。

### 4.3 数据存储与同步 (Storage & Sync)

#### 4.3.1 架构策略
采用 **"加密文件库 (File-Based Vault)"** 策略。应用操作一个加密的数据库文件，所有敏感字段加密存储，仅公开必要的元数据（如 UUID, UpdatedAt）用于同步校验。

#### 4.3.2 冲突解决 (Conflict Resolution)
由于无服务端仲裁，当检测到多端同时修改导致冲突时：
*   **策略:** **保留冲突副本 (Keep Both)**。应用会自动将冲突的远程文件重命名并下载到本地。
*   **用户介入:** 提示用户发现冲突，并提供简单的合并界面。

#### 4.3.3 离线支持 (Offline Mode)
*   **完全读写:** 应用优先读写本地缓存文件，在离线状态下所有功能均可用。
*   **自动恢复:** 网络恢复后，依赖底层云服务（iCloud/厂商云）自动触发文件同步。

#### 4.3.4 跨平台同步行为
*   **存储位置自动化**: 存储位置由程序自动选择平台特定位置（iOS/macOS 默认使用 `Documents` 目录以支持 iCloud 同步；Android 默认使用应用私有存储，依赖厂商云备份或用户自行同步）。此选项在设置中仅显示，不可手动更改。
*   **Apple 生态 (macOS / iOS):**
    *   **iCloud Drive 集成:** 密码库文件自动同步至用户的 iCloud Drive。当 iCloud 未激活或未开启对本应用的同步时，设置页面会显示相应的同步状态提示。

### 4.4 共享功能 (Shared Features)
*   **密码管理:** 增删改查、搜索（支持实时搜索明文标题、用户名及备注关键词）。
*   **数据迁移 (Import/Export):**
    *   **导入:** 支持从 Chrome CSV 导入数据。导入功能移至"设置"页面。
*   **多语言支持 (i18n):** 支持简体中文、英文，应用启动时默认跟随系统语言，可在设置中切换。
*   **主题管理:** 
    *   支持三种模式：跟随系统、暗黑模式 (Dark)、白天模式 (Light)。
    *   默认为"跟随系统"，可在设置中切换。
*   **添加密码交互:** 提供一个独立的"新增条目"页面，采用 Cupertino 风格的表单输入，支持完整录入：标题、账号、密码、URL、备注及附件。
*   **详情页功能**: 
    *   支持密码隐藏/显示，并提供全屏放大显示密码功能（移动端横屏）。
    *   支持一键复制所有内容（用户名、密码、网址、备注按换行组合）。
    *   支持附件的直接打开。
*   **本地备份:** 每次重大修改前，自动在本地沙盒保留最近 5 份历史快照，防止文件损坏。
*   **密码生成器:** 自定义长度、字符类型。
*   **剪贴板管理:** 复制密码后，一定时间（如 60秒）自动清空剪贴板。

### 4.5 首次使用流程 (Onboarding)
1.  **欢迎页:** 介绍核心价值（安全、私有）。
2.  **创建主密码:** 强制高强度密码检查，并确保密码匹配和长度要求，提供本地化错误提示。
3.  **自动配置存储位置**: 程序自动选择并配置合适的存储路径（如 iOS 的 `Documents` 目录）。不再需要用户手动选择。
4.  **导入数据 (可选):** 成功创建密码库后，自动弹窗引导用户是否从 CSV 文件导入现有密码。
5.  **进入主界面。**

### 4.6 设置 (Settings)
*   **外观**: 
    *   **主题模式**: 可选择"跟随系统"、"深色模式"、"白天模式"。
    *   **语言**: 可选择"跟随系统"、"English"、"简体中文"。
*   **数据**: 
    *   **导入**: 允许用户从 CSV 文件导入密码（格式：标题/账号/密码/备注）。
*   **安全**: 
    *   **生物识别**: 开启/关闭生物识别解锁。
    *   **自动锁屏延迟**: 通过 Action Sheet 设置应用切后台后自动锁定的时间 (不限时，1秒，5秒，10秒，30秒，60秒)。
    *   **重置密码**: 支持在已知原密码的情况下修改主密码。
*   **关于**: 显示应用名称和版本号。

---

## 5. 移动端交互设计 (Mobile Experience) 📱

### 5.1 设计原则
*   **平台规范:** 完全遵循 iOS 设计规范 (Apple Human Interface Guidelines)，采用 Cupertino Widgets。
*   **导航模式:** 页面栈式导航 (列表页 → 详情页 → 编辑页)，通过独立页面跳转。
*   **触控优先:** 优化手指触控区域，支持滑动操作。
*   **单手操作:** 常用功能可单手完成。

### 5.2 核心页面

#### 5.2.1 解锁页 (Unlock Page)
*   **生物识别:** 支持 FaceID/TouchID 快捷解锁。
*   **密码输入:** 手动输入主密码解锁。
*   **首次设置:** 引导创建主密码。

#### 5.2.2 首页 - 密码列表 (Home Page)
*   **搜索栏:** 顶部搜索框，支持实时过滤。
*   **密码列表:** 
    *   每个条目显示：图标 (favicon/首字母)、标题、用户名/日期。
    *   点击进入详情页。
    *   支持滑动删除。
*   **悬浮按钮:** 右下角"+"按钮，用于新增密码。
*   **导航栏:**
    *   左侧：设置入口 (齿轮图标)。
    *   右侧：批量选择、锁定。

#### 5.2.3 详情页 (Detail Page)
*   **分组展示:** URL、凭据（用户名+密码）、备注、附件。
*   **密码操作:**
    *   点击"眼睛"图标切换显示/隐藏。
    *   点击复制按钮复制对应字段。
    *   全屏放大显示密码（横屏）。
*   **编辑入口:** 右上角编辑按钮。
*   **删除入口:** 右上角删除按钮。

#### 5.2.4 设置页 (Settings Page)
*   **外观设置:** 主题模式、语言。
*   **数据管理:** 导入 CSV。
*   **安全设置:** 生物识别、自动锁屏、重置密码。
*   **关于:** 应用信息、版本号。

### 5.3 交互特性
*   **页面过渡:** iOS 风格滑动动画 (CupertinoPageRoute)。
*   **手势操作:**
    *   左滑删除列表项。
    *   下拉刷新列表（可选）。
*   **弹窗样式:** 底部 Action Sheet (CupertinoActionSheet) 进行选项选择。
*   **Toast 提示:** 复制成功等操作使用简短弹窗自动关闭。

### 5.4 技术实现
*   **框架:** Flutter + Cupertino Widgets。
*   **状态管理:** Riverpod。
*   **页面路由:** CupertinoPageRoute，独立页面栈管理。

---

## 6. 桌面端交互设计 (Desktop Experience) 💻

### 6.1 设计原则
*   **效率优先:** 减少操作步骤，支持键盘快捷操作。
*   **常驻访问:** 菜单栏图标常驻，快速调用。
*   **双栏布局:** 左侧列表 + 右侧详情，无需页面跳转。
*   **窗口管理:** 记住窗口位置与大小。

### 6.2 页面架构

#### 6.2.1 两栏主布局 (Two-Column Layout with Draggable Divider)
```
┌─────────────────────────────────────────────────────────────────────────────┐
│  🔒  密码本                                       [+ 新建] [🔒 锁定]        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────┐ ┌───────────────────────────────────────────────┐ │
│  │ 🔍 搜索密码...      │ │                                               │ │
│  ├─────────────────────┤ │                                               │ │
│  │                     │ │                                               │ │
│  │ ┌───────────────┐   │ │              ┌─────────────────────┐          │ │
│  │ │ 🟢 G          │   │ │              │ GitHub              │          │ │
│  │ │ GitHub        │   │ │              │                     │          │ │
│  │ │ user@...     │   │ │              │ 👤 user@example.com │          │ │
│  │ └───────────────┘   │ │              │ 🔑 ••••••••   👁 📋│          │ │
│  │                     │ │              │ 🌐 github.com      📋│          │ │
│  │ ┌───────────────┐   │ │              │                     │          │ │
│  │ │ 🔵 A          │   │ │              │ 📝 Notes:          │          │ │
│  │ │ Apple         │   │ │              │    我的工作账号      │          │ │
│  │ │ apple@...    │   │ │              │                     │          │ │
│  │ └───────────────┘   │ │              │                     │          │ │
│  │                     │ │              │ ┌─────────────────┐ │          │ │
│  │ ┌───────────────┐   │ │              │ │ 📎 证书.pdf    │ │          │ │
│  │ │ 🟡 N          │   │ │              │ └─────────────────┘ │          │ │
│  │ │ Netflix       │   │ │              │                     │          │ │
│  │ │ net@...      │   │ │              ├─────────────────────┤          │ │
│  │ └───────────────┘   │ │              │                     │          │ │
│  │                     │ │              │  [✏️ 编辑]          │ [🗑️ 删除] │ │
│  │ ...                 │ │              │                     │          │ │
│  │                     │ │              └─────────────────────┘          │ │
│  │                     │ │                                               │ │
│  │ ─────────────────── │ │                                               │ │
│  │   ⚙️ 设置           │ │                                               │ │
│  └─────────────────────┘ └───────────────────────────────────────────────┘ │
│       ↔️ 可拖拽                                                          │
└─────────────────────────────────────────────────────────────────────────────┘
   左侧栏                    右侧栏
  (250-500px               (自适应
   可拖拽)                  宽度)
```

**核心特性：**
*   **可拖拽分割线:** 用户可通过拖拽中间分割线调整左右比例
*   **左侧栏宽度范围:** 最小 250px，最大 500px，默认 350px
*   **搜索栏:** 顶部固定，实时搜索过滤
*   **密码列表:** 显示图标 + 标题 + 用户名/域名
*   **设置按钮:** 位于左侧栏左下角，点击弹出设置弹窗
*   **编辑按钮:** 位于右侧详情面板右上角

**右侧面板状态：**
*   有选中项：显示密码详情 + 编辑/删除按钮
*   无选中项：显示空状态提示"请选择左侧条目"

#### 6.2.2 设置弹窗
*   **触发方式:** 点击左下角 ⚙️ 设置按钮
*   **弹窗类型:** 模态弹窗（居中显示）
*   **内容:** 与移动端设置页一致
*   **关闭方式:** 点击右上角 ✕ 或弹窗外部区域

```
┌─────────────────────────────────────────┐
│  ⚙️ 设置                           ✕    │
├─────────────────────────────────────────┤
│                                         │
│  外观                                    │
│  ┌─────────────────────────────────┐   │
│  │ 主题           >                 │   │
│  ├─────────────────────────────────┤   │
│  │ 语言           >                 │   │
│  └─────────────────────────────────┘   │
│                                         │
│  安全                                    │
│  ┌─────────────────────────────────┐   │
│  │ 生物识别        [开关]           │   │
│  ├─────────────────────────────────┤   │
│  │ 自动锁屏        >                │   │
│  ├─────────────────────────────────┤   │
│  │ 重置密码        >                │   │
│  └─────────────────────────────────┘   │
│                                         │
│  关于                                    │
│  ┌─────────────────────────────────┐   │
│  │ 版本 1.0.0                      │   │
│  └─────────────────────────────────┘   │
│                                         │
└─────────────────────────────────────────┘
```

#### 6.2.3 macOS 设计规范
| 元素 | 实现方式 |
|------|----------|
| 标题栏 | macOS 风格导航栏 |
| 图标 | SF Symbols (CupertinoIcons) |
| 圆角 | 12px 圆角卡片 |
| 颜色 | 跟随系统深色/浅色模式 |
| 字体 | SF Pro Text / 系统默认字体 |
| 分割线 | 1px 宽，可拖拽交互 |

### 6.3 菜单栏/系统托盘常驻图标

#### 6.3.1 功能定位
参考 1Password/Bitwarden 桌面端，在系统菜单栏 (macOS) 或系统托盘 (Windows/Linux) 常驻图标，实现快速交互。

#### 6.3.2 核心功能
| 功能 | 描述 |
|------|------|
| **快速搜索** | 点击图标弹出搜索框，可即时搜索并复制密码 |
| **最近使用** | 显示最近访问的 5 个密码条目 |
| **一键锁定** | 快速锁定密码库 |
| **打开主窗口** | 启动或呼起主应用窗口 |
| **退出应用** | 完全退出应用 |

#### 6.3.3 交互流程
1.  用户点击菜单栏图标
2.  弹出浮动面板 (类似 1Password Mini)
3.  用户可直接搜索或选择最近条目
4.  点击任意条目自动复制密码到剪贴板
5.  面板自动隐藏

#### 6.3.4 技术实现
*   **macOS:** 使用 `tray_manager` 包实现菜单栏图标。
*   **Windows:** 使用系统托盘 (System Tray)。
*   **Linux:** 使用 AppIndicator。

### 6.4 键盘快捷键

| 快捷键 | 功能 | 平台通用 |
|--------|------|----------|
| `Cmd/Ctrl + F` | 聚焦搜索框 | ✅ |
| `Cmd/Ctrl + N` | 新建密码 | ✅ |
| `Cmd/Ctrl + C` | 复制选中项密码 | ✅ |
| `Cmd/Ctrl + ,` | 打开设置 | ✅ |
| `Cmd/Ctrl + L` | 锁定密码库 | ✅ |
| `Cmd/Ctrl + W` | 关闭当前窗口 | ✅ |
| `Cmd/Ctrl + Q` | 退出应用 | ✅ |
| `Esc` | 退出详情面板 / 取消选择 | ✅ |
| `↑/↓` | 列表上下导航 | ✅ |
| `Enter` | 选中当前项 | ✅ |

### 6.5 右键菜单支持
*   **列表项右键:**
    *   复制密码
    *   复制用户名
    *   打开网址
    *   编辑
    *   删除

### 6.6 技术实现

#### 6.6.1 架构分层
```
lib/
├── core/platform/
│   └── platform_utils.dart    # 平台检测
├── presentation/pages/
│   ├── mobile/                # 移动端页面
│   ├── desktop/               # 桌面端页面
│   ├── shared/                # 共享页面
│   └── page_factory.dart      # 页面工厂
└── main.dart                  # 入口根据平台选择
```

#### 6.6.2 平台检测
```dart
enum AppPlatform { mobile, desktop }

class PlatformUtils {
  static AppPlatform get platform {
    if (Platform.isMacOS || Platform.isWindows || Platform.isLinux) {
      return AppPlatform.desktop;
    }
    return AppPlatform.mobile;
  }
}
```

#### 6.6.3 页面工厂
```dart
class PageFactory {
  static Widget getHomePage() {
    return PlatformUtils.isDesktop 
        ? DesktopHomePage()   // 两栏布局
        : MobileHomePage();    // 列表页跳转
  }
}
```

#### 6.6.4 依赖包
```yaml
dependencies:
  tray_manager: ^0.2.3      # 菜单栏图标
  window_manager: ^0.4.3    # 窗口管理
  hotkey_manager: ^0.2.3    # 全局快捷键
```

---

## 7. 非功能需求 (Non-Functional Requirements)

### 7.1 安全性 (Security)
*   **加密算法:** 使用工业级标准加密（AES-256-GCM 或 XChaCha20-Poly1305）。
*   **密钥派生:** 使用 Argon2id 或 PBKDF2 对主密码进行哈希处理，防止暴力破解。
*   **本地存储:** 即使在同步失败时，本地也必须保留完整副本。
*   **内存安全:** 敏感数据使用后及时清理，避免内存中明文留存。

### 7.2 性能 (Performance)
*   **启动速度:** 
    *   移动端: 冷启动至解锁界面 < 1秒。
    *   桌面端: 冷启动至主界面 < 2秒。
*   **解密速度:** 验证主密码并加载列表 < 1秒（对于常规数据量 < 5000 条）。
*   **大文件优化:** 当数据库大小 > 5MB (约 10,000+ 条目) 时，应采用流式解密或懒加载列表，避免 UI 卡顿。
*   **桌面端响应:** 菜单栏点击响应 < 200ms，密码复制 < 100ms。

### 7.3 兼容性 (Compatibility)
*   **iOS:** iOS 15.0+
*   **macOS:** macOS 12.0+ (支持 Apple Silicon & Intel)
*   **Windows:** Windows 10+ (64-bit)
*   **Android:** Android 10.0+ (API Level 29+, 确保完善的 SAF 支持)
*   **Linux:** 主流发行版 (Ubuntu, Fedora, Arch)，提供 AppImage 或 Flatpak。

### 7.4 平台独立性
*   桌面端与移动端代码完全分离，通过平台检测动态选择。
*   共享业务逻辑（providers, services, models）复用率 > 90%。
*   各自独立迭代，互不影响。

---

## 8. 不在范围 (Out of Scope)

*   **团队共享/企业版:** 不支持多用户共享密码库。
*   **浏览器插件:** MVP 阶段暂不开发 Chrome/Safari 插件，优先保证 App 体验。
*   **云端备份:** 我们不提供任何云存储服务，用户必须自己负责数据的云端备份（通过 iCloud/手机厂商云）。

---

## 9. UI/UX 设计规范 (Design Guidelines)

### 9.1 移动端设计规范
*   **设计风格:** 完全遵循 iOS 设计规范 (Apple Human Interface Guidelines)。
*   **组件:** 所有页面采用 Cupertino Widgets。
*   **交互:**
    *   iOS 风格底部 Action Sheet 进行选项选择。
    *   分组样式、圆角卡片容器。
    *   iOS 配色方案 (SF Symbols, `#007AFF` 强调色)。
*   **深色模式:** 全平台必须完美适配深色模式 (Dark Mode)。

### 9.2 桌面端设计规范
*   **布局:** 两栏布局 (列表 + 详情面板)。
*   **视觉:** 保持与移动端一致的设计语言，适配桌面端审美。
*   **图标:** 使用 SF Symbols 或等效图标集。
*   **响应式:** 适配不同尺寸的桌面窗口。

---

## 10. 后续规划 (Roadmap)

### P0 (MVP) - 已完成
*   基础数据模型 (Vault/Item)。
*   本地加密存储 (AES-256)。
*   iCloud Drive (iOS/Mac) & SAF (Android) 同步适配。
*   冲突解决机制。
*   数据导入 (Import)。
*   生物识别解锁 (FaceID/Fingerprint)。
*   批量删除。
*   自动锁屏。
*   Material → Cupertino UI 迁移。
*   密码全屏放大显示。

### P1 (当前)
*   桌面端两栏布局开发。
*   菜单栏/系统托盘常驻图标。
*   快速搜索弹窗。
*   全局快捷键支持。
*   密码历史记录 (Password History)。
*   本地定期备份。

### P2
*   附件/证书加密存储。
*   TOTP/2FA 验证码生成器。
*   Passkeys (FIDO2/WebAuthn) 支持。

### P3
*   WebDAV 同步协议支持。

---

## 11. 开发进度 (Development Progress)

### 2026-02-27 更新

#### 已完成功能 ✅

| 功能 | 描述 | 平台 | 状态 |
|------|------|------|------|
| **Material → Cupertino UI 迁移** | 将所有 Material 组件替换为 Cupertino 组件 | 移动端 | ✅ |
| **iCloud 同步** | Timer 轮询检测文件变化，自动刷新密码库 | 移动端 | ✅ |
| **CSV 导入增强** | 自动检测表头，支持无表头 CSV | 共享 | ✅ |
| **批量删除** | 列表选择模式，多选后批量删除 | 移动端 | ✅ |
| **密码全屏显示** | 使用 SystemChrome 真正旋转屏幕 | 移动端 | ✅ |
| **生物识别优化** | 移除解锁页自动触发，添加详细错误提示 | 移动端 | ✅ |
| **自动锁定** | 使用 AppLifecycleState 检测后台/前台 | 共享 | ✅ |
| **桌面端架构设计** | 平台检测 + 页面工厂模式 | 桌面端 | ✅ |
| **PRD 文档更新** | 按移动端/桌面端分章节描述 | 文档 | ✅ |

#### 开发中 🚧

| 功能 | 描述 | 平台 | 状态 |
|------|------|------|------|
| **两栏布局** | 左侧列表 + 右侧详情面板 | 桌面端 | 🚧 开发中 |
| **菜单栏图标** | 系统托盘常驻 + 快速搜索 | 桌面端 | 📋 待开发 |
| **快捷键支持** | 全局键盘快捷键 | 桌面端 | 📋 待开发 |
| **右键菜单** | 列表项右键操作 | 桌面端 | 📋 待开发 |

#### 待解决问题 🔧

| 问题 | 描述 | 状态 |
|------|------|------|
| **真机崩溃** | 在真机上打开详情页→按 Home→重新打开 App→崩溃 | 🔄 调试中 |
| **真机部署** | 代码签名问题 (0xe8008014)，需在 Xcode 中配置 Development Team | 🔄 待解决 |

#### 技术细节

*   **密码放大显示**: 使用 `SystemChrome.setPreferredOrientations` 真正旋转屏幕，退出时先恢复竖屏再退出
*   **密码显示**: 每个字符 + 位号上下结构显示，隔位换色
*   **URL favicon**: 自动补全 `https://` 前缀，确保图标下载成功
*   **iCloud 同步**: Timer 轮，通过比较 modification time 忽略自身修改
*   **询检测文件变化桌面端架构**: 
    *   `PlatformUtils` 统一检测平台
    *   `PageFactory` 工厂类动态创建页面
    *   `mobile/` 和 `desktop/` 目录完全分离

---

## 12. 风险与对策 (Risks & Mitigations)

| 风险 (Risk) | 可能性 (Likelihood) | 严重性 (Severity) | 对策 (Mitigation) |
| :--- | :--- | :--- | :--- |
| **同步冲突导致数据丢失** | 中 | 高 | 1. 强制采用"保留冲突副本"策略。<br>2. 每次写入前先校验文件 hash。<br>3. 保留本地历史快照 (Local Backup)。 |
| **用户主密码遗忘** | 低 | 极高 | 1. 支持生物识别重置: 设备有生物识别时，可通过生物验证重置密码。<br>2. 重建密码库: 无生物识别时，可清除旧数据创建新库（自动备份旧库）。<br>3. 首次设置时强制输入两次确认。 |
| **云服务不可用 (断网/API变更)** | 低 | 中 | 1. 优先读写本地缓存，离线可用。<br>2. 支持手动导出/导入文件作为备用方案。 |
| **Android SAF 性能瓶颈** | 中 | 中 | 1. 针对大文件 (>5MB) 进行流式读写优化。<br>2. 仅在必要时全量加载，列表页仅加载元数据。 |
| **桌面端与移动端代码耦合** | 中 | 中 | 1. 严格遵循平台分离架构。<br>2. 使用 PageFactory 工厂模式。<br>3. 共享代码通过 shared 目录管理。 |
